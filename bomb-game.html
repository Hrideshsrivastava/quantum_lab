<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomb Detection Challenge</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        :root {
    /* Core Colors */
    --bg-primary: #0a0e17;
    --bg-secondary: #141b2d;
    --bg-card: #1a2332;
    --bg-hover: #222d42;
    
    /* Neon Accents */
    --neon-blue: #00d4ff;
    --neon-cyan: #00fff9;
    --neon-purple: #b026ff;
    --neon-green: #39ff14;
    --neon-red: #ff0844;
    --neon-yellow: #ffed4e;
    
    /* Text Colors */
    --text-primary: #e8edf4;
    --text-secondary: #a0aec0;
    --text-dim: #718096;
    
    /* UI Elements */
    --border-color: rgba(0, 212, 255, 0.2);
    --shadow-glow: 0 0 20px rgba(0, 212, 255, 0.3);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    height: 100vh; /* Force viewport height */
    overflow: hidden; /* Prevent body scroll globally */
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
    height: 100%;
    display: flex;
    flex-direction: column;
}

/* ============================================
   TYPOGRAPHY
   ============================================ */

h1 {
    font-size: 2.5rem; /* Slightly reduced for fit */
    font-weight: 700;
    background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 0.5rem;
}

h2 { font-size: 1.8rem; color: var(--text-primary); margin: 1.5rem 0 1rem; }
h3 { font-size: 1.1rem; color: var(--neon-cyan); margin-bottom: 0.5rem; font-weight: 600; }
p { color: var(--text-secondary); margin-bottom: 1rem; }

/* 1. Ensure Body & Container act as a Flex Column */
body.game-page {
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.game-page .container {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1rem; /* Reduced padding for game view */
    max-height: 100vh;
}

/* 2. Header shouldn't shrink, but stay compact */
.compact-header {
    flex-shrink: 0;
    text-align: center;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 1rem;
}

.compact-header h1 {
    font-size: 1.8rem; /* Smaller title for game mode */
    margin-bottom: 0.25rem;
}

.game-status-bar {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
}

/* 3. Main Game Area: Takes ALL remaining space */
.game-main {
    flex: 1;
    min-height: 0; /* CRITICAL: Allows flex child to shrink below content size */
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Prevent main overflow */
}

/* 4. Grid Layout: Fixed columns, fills height */
.game-grid {
    display: grid;
    grid-template-columns: 1fr 320px 200px;
    gap: 1rem;
    height: 100%;
    min-height: 0; /* CRITICAL for grid nesting */
}

/* 5. Left Panel: Channels (Scrollable) */
.channels-area {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
    overflow-y: auto; /* Scroll INSIDE this box */
    height: 100%;
    display: flex;
    flex-direction: column;
}

.channel-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); /* Auto-fill buttons */
    gap: 0.5rem;
    align-content: start;
}

/* 6. Middle & Right Panels */
.channel-info, .controls-area {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
    height: 100%;
    overflow-y: auto; /* Allow scroll on small screens */
    display: flex;
    flex-direction: column;
}

/* ============================================
   GAME COMPONENTS
   ============================================ */

/* Channel Buttons */
.channel-btn-compact {
    background: var(--bg-secondary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 0.5rem;
    cursor: pointer;
    transition: all 0.2s ease;
    min-height: 60px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.channel-btn-compact:hover { border-color: var(--neon-cyan); background: var(--bg-hover); }
.channel-btn-compact.selected { border-color: var(--neon-cyan); box-shadow: inset 0 0 10px rgba(0, 212, 255, 0.2); }
.channel-btn-compact.locked { border-color: var(--neon-green); opacity: 0.6; }
.channel-btn-compact.exploded { border-color: var(--neon-red); background: rgba(255, 8, 68, 0.15); }

.ch-label { font-size: 0.9rem; font-weight: 700; color: var(--text-primary); }
.ch-stat { font-size: 0.75rem; color: var(--text-dim); }

/* Status Items */
.status-item {
    background: var(--bg-secondary);
    padding: 0.5rem 1rem;
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}
.status-item span { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; display: block; }
.status-item strong { font-size: 1.2rem; color: var(--neon-cyan); }

/* Info Panel Stats */
.channel-stats-compact {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
    margin-bottom: 1rem;
}
.stat-compact {
    background: var(--bg-secondary);
    padding: 0.5rem;
    border-radius: 4px;
    text-align: center;
}
.stat-compact strong { display: block; font-size: 1.1rem; color: var(--neon-cyan); }
.stat-compact span { font-size: 0.7rem; color: var(--text-dim); }

#channelGraph {
    width: 100%;
    height: 200px;
    background: var(--bg-secondary);
    border-radius: 4px;
    margin-top: 1rem;
    border: 1px solid var(--border-color);
}

/* Control Buttons */
.controls-area { gap: 1rem; }

.control-btns { display: flex; flex-direction: column; gap: 0.5rem; }
.control-btns button {
    padding: 1rem;
    background: var(--bg-secondary);
    border: 2px solid var(--neon-cyan);
    color: var(--neon-cyan);
    border-radius: 6px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
}
.control-btns button:hover { 
    background: var(--neon-cyan); 
    color: var(--bg-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
}

.decision-btns { margin-top: auto; display: flex; flex-direction: column; gap: 0.75rem; }
.bomb-btn {
    padding: 1.2rem; 
    background: rgba(255, 8, 68, 0.1); 
    border: 2px solid var(--neon-red); 
    color: var(--neon-red);
    border-radius: 6px; 
    font-weight: 700; 
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 1rem;
}
.bomb-btn:hover { 
    background: var(--neon-red); 
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 8, 68, 0.5);
}
.safe-btn {
    padding: 1.2rem; 
    background: rgba(57, 255, 20, 0.1); 
    border: 2px solid var(--neon-green); 
    color: var(--neon-green);
    border-radius: 6px; 
    font-weight: 700; 
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 1rem;
}
.safe-btn:hover { 
    background: var(--neon-green); 
    color: black;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(57, 255, 20, 0.5);
}

/* ============================================
   RESPONSIVE
   ============================================ */
@media (max-width: 1000px) {
    .game-grid {
        grid-template-columns: 1fr 250px; /* Hide controls or stack them? */
        grid-template-rows: 1fr auto;
    }
    .controls-area {
        grid-column: 1 / -1;
        flex-direction: row;
        height: auto;
        justify-content: space-between;
    }
    .decision-btns { flex-direction: row; width: 50%; margin-top: 0;}
    .control-btns { width: 50%; }
}

@media (max-width: 700px) {
    .game-grid {
        display: flex;
        flex-direction: column;
        overflow-y: auto; /* Allow full page scroll on mobile */
    }
    body.game-page { height: auto; overflow: auto; }
    .game-page .container { height: auto; max-height: none; }
    .game-main { overflow: visible; }
}

/* ============================================
   MODAL
   ============================================ */
.modal {
    display: none;
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.95); z-index: 1000;
    align-items: center; justify-content: center;
    padding: 1rem;
    overflow-y: auto;
}
.modal.active { display: flex; }
.modal-content {
    background: var(--bg-card); border: 2px solid var(--neon-cyan);
    border-radius: 12px; padding: 1.5rem; max-width: 600px; width: 90%;
    box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
    max-height: 85vh;
    overflow-y: auto;
    margin: auto;
}

.modal-content h3 {
    margin-top: 0;
    margin-bottom: 1rem;
}

.results-summary {
    text-align: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
}

.score-display {
    font-size: 1.5rem;
    margin-top: 0.5rem;
    color: var(--neon-cyan);
}

.results-stats {
    background: var(--bg-secondary);
    padding: 1rem;
    border-radius: 6px;
    margin-bottom: 1rem;
}

.result-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.result-row:last-child {
    border-bottom: none;
}

.result-row.highlight-row {
    background: rgba(57, 255, 20, 0.05);
    padding: 0.75rem;
    margin: 0.5rem 0;
    border-radius: 4px;
    border: 1px solid rgba(57, 255, 20, 0.2);
}

.explosion-text { color: var(--neon-red); }
.safe-text { color: var(--neon-green); }

.wow-box {
    background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(176, 38, 255, 0.1));
    border: 2px solid var(--neon-cyan);
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
}

.wow-box h3 {
    color: var(--neon-cyan);
    margin-bottom: 0.75rem;
}

.wow-stat {
    font-size: 1.2rem;
    color: var(--neon-green);
    margin: 0.75rem 0;
}

.wow-emphasis {
    font-style: italic;
    color: var(--neon-purple);
    font-weight: 600;
}

.channel-breakdown {
    margin-top: 1rem;
}

.channel-breakdown h4 {
    color: var(--text-primary);
    margin-bottom: 0.75rem;
}

.results-table-compact {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.results-table-compact th,
.results-table-compact td {
    padding: 0.5rem;
    text-align: center;
    border: 1px solid var(--border-color);
}

.results-table-compact th {
    background: var(--bg-secondary);
    color: var(--neon-cyan);
    font-weight: 600;
}

.bomb-cell { color: var(--neon-red); font-weight: 600; }
.safe-cell { color: var(--neon-green); font-weight: 600; }

.cta-button {
    width: 100%;
    margin-top: 1rem;
}

.cta-button {
    background: var(--neon-cyan); 
    color: #000; 
    padding: 1rem 2rem;
    border: none; 
    border-radius: 6px; 
    font-weight: 700; 
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.cta-button:hover {
    background: var(--neon-blue);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.5);
}
</style>
</head>
<body class="game-page">
    <div class="container no-scroll">
        <header class="compact-header">
            <h1>Bomb Detection Challenge</h1>
            <div class="game-status-bar">
                <div class="status-item">
                    <span>Level:</span>
                    <strong id="currentLevel">1</strong>
                </div>
                <div class="status-item">
                    <span>Timer:</span>
                    <strong id="timer">30</strong>
                </div>
                <div class="status-item">
                    <span>Score:</span>
                    <strong id="totalScore">0</strong>
                </div>
            </div>
        </header>

        <main class="game-main">
            <div class="game-grid">
                <!-- Channel Grid -->
                <div class="channels-area">
                    <div class="channel-grid" id="channelGrid"></div>
                </div>

                <!-- Selected Channel Display -->
                <div class="channel-info">
                    <h3>Channel <span id="selectedCh">â€”</span></h3>
                    <div class="channel-stats-compact">
                        <div class="stat-compact">
                            <span>Photons:</span>
                            <strong id="chPhotons">0</strong>
                        </div>
                        <div class="stat-compact">
                            <span>D1:</span>
                            <strong id="chD1">0</strong>
                        </div>
                        <div class="stat-compact">
                            <span>D2:</span>
                            <strong id="chD2">0</strong>
                        </div>
                        <div class="stat-compact explosion-compact">
                            <span>Explosions:</span>
                            <strong id="chExplosions">0</strong>
                        </div>
                    </div>
                    <canvas id="channelGraph" width="300" height="200"></canvas>
                </div>

                <!-- Controls -->
                <div class="controls-area">
                    <div class="control-btns">
                        <button onclick="bombGame.sendPhotons(1)">Send 1 Photon</button>
                    </div>
                    <div class="decision-btns">
                        <button class="bomb-btn" onclick="bombGame.lockDecision(true)">Bomb</button>
                        <button class="safe-btn" onclick="bombGame.lockDecision(false)">No Bomb</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Results Modal -->
        <div id="resultsModal" class="modal">
            <div class="modal-content">
                <h2>Round Complete!</h2>
                <div id="resultsBody"></div>
                <button class="cta-button" onclick="bombGame.nextLevel()">Continue</button>
            </div>
        </div>
    </div>

    <script src="bomb-game.js"></script>
</body>
</html>